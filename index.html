<!DOCTYPE html>
<html lang="zh-HK">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ÈÄ£Êé•Ë©ûÁ∑¥Áøí</title>
    <link href="https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap" rel="stylesheet">
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>

    <style>
        :root {
            --font-main: 'ZCOOL KuaiLe', cursive;
            --bg-sky: #87CEEB;
            --card-bg: #FFFFFF;
            --zone-border: #BDBDBD;
            --zone-active: #FFEB3B;
            --zone-correct: #AED581;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; padding: 0; font-family: var(--font-main); background-color: var(--bg-sky); 
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            display: flex; justify-content: center; align-items: center; 
            overflow: hidden; 
        }

        /* ËÉåÊôØÂä®Áîª */
        .sky-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; background: linear-gradient(180deg, #4FC3F7 0%, #81D4FA 100%); pointer-events: none; }
        .cloud { position: absolute; background: rgba(255, 255, 255, 0.8); border-radius: 50px; animation: floatCloud linear infinite; }
        .cloud::after, .cloud::before { content: ''; position: absolute; background: inherit; border-radius: 50%; }
        .c1 { width: 120px; height: 50px; top: 10%; left: -20%; animation-duration: 25s; }
        .c1::after { width: 60px; height: 60px; top: -30px; left: 15px; }
        .c1::before { width: 50px; height: 50px; top: -20px; left: 55px; }
        @keyframes floatCloud { 0% { transform: translateX(-150px); } 100% { transform: translateX(110vw); } }
        .grass { position: absolute; bottom: 0; left: 0; width: 100%; height: 60px; background: #AED581; border-radius: 50% 50% 0 0 / 100% 100% 0 0; transform: scaleX(1.5); z-index: 1; pointer-events: none; }

        /* ‰∏ªÂÆπÂô® */
        .app-container {
            width: 95%; height: 95%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px; border: 4px solid #fff;
            box-shadow: 0 0 0 4px #B3E5FC, 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex; flex-direction: column; position: relative; overflow: hidden; z-index: 10;
        }

        /* ÊåâÈíÆ‰∏éÈÄöÁî®ÁªÑ‰ª∂ */
        .btn { cursor: pointer; transition: transform 0.1s; display: flex; align-items: center; justify-content: center; }
        .btn:active { transform: scale(0.95); }
        .sound-btn { width: 44px; height: 44px; background: #FFEB3B; border-radius: 50%; border: 3px solid #FBC02D; color: #F57F17; font-size: 22px; box-shadow: 0 3px 0 #FBC02D; margin-left: 10px; flex-shrink: 0; }
        .back-btn { position: absolute; top: 10px; left: 10px; background: #FF7043; color: white; padding: 8px 20px; border-radius: 25px; font-size: 18px; border: 3px solid #fff; box-shadow: 0 4px 0 #D84315; z-index: 100; }

        /* Â±èÂπïÂàáÊç¢ÈÄªËæë */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: transparent; z-index: 10; display: none; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 60px; }

        .menu-title { font-size: 40px; color: #01579B; margin-bottom: 20px; font-weight: 900; animation: wiggle 3s infinite; }
        @keyframes wiggle { 0%,100%{transform:rotate(-2deg);} 50%{transform:rotate(2deg);} }
        
        .menu-grid { display: flex; gap: 15px; width: 95%; justify-content: center; flex-wrap: wrap; overflow-y: auto; padding-bottom: 40px; flex: 1; -webkit-overflow-scrolling: touch; }
        
        /* ËèúÂçïÂàóË°®Ê†∑Âºè */
        .theme-card { 
            flex: 0 0 45%; 
            max-width: 200px; 
            aspect-ratio: 3/4; 
            background: #fff; 
            border-radius: 20px; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border: 5px solid transparent; 
            margin-bottom: 10px; 
        }

        /* iPad / Âπ≥ÊùøÂ§ßÂ±è‰∏ìÂ±ûÊîæÂ§ßËèúÂçï */
        @media (min-width: 768px) {
            .theme-card {
                flex: 0 0 30%;      
                max-width: 300px;    
                min-height: 380px;   
                margin-bottom: 30px; 
            }
            .card-icon { font-size: 80px !important; margin-bottom: 20px !important; }
            .card-text { font-size: 36px !important; }
        }

        .theme-1 { border-color: #4FC3F7; background: radial-gradient(circle at 50% 30%, #E1F5FE, #fff); box-shadow: 0 5px 0 #0288D1; }
        .theme-2 { border-color: #FFB74D; background: radial-gradient(circle at 50% 30%, #FFF3E0, #fff); box-shadow: 0 5px 0 #F57C00; }
        .theme-3 { border-color: #AED581; background: radial-gradient(circle at 50% 30%, #F1F8E9, #fff); box-shadow: 0 5px 0 #689F38; }
        .theme-4 { border-color: #BA68C8; background: radial-gradient(circle at 50% 30%, #F3E5F5, #fff); box-shadow: 0 5px 0 #8E24AA; }
        .theme-5 { border-color: #F06292; background: radial-gradient(circle at 50% 30%, #FCE4EC, #fff); box-shadow: 0 5px 0 #C2185B; }
        .theme-6 { border-color: #7986CB; background: radial-gradient(circle at 50% 30%, #E8EAF6, #fff); box-shadow: 0 5px 0 #3F51B5; }
        .theme-7 { border-color: #26A69A; background: radial-gradient(circle at 50% 30%, #E0F2F1, #fff); box-shadow: 0 5px 0 #00796B; }
        .theme-8 { border-color: #FF7043; background: radial-gradient(circle at 50% 30%, #FBE9E7, #fff); box-shadow: 0 5px 0 #D84315; }

        /* Êñ∞Â¢ûÔºöÂè≥‰∏ãËßíÊÇ¨ÊµÆÊåâÈíÆÊ†∑Âºè (FAB) */
        .random-fab {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFD54F 0%, #FFB300 100%);
            border: 4px solid #fff;
            box-shadow: 0 6px 15px rgba(255, 160, 0, 0.4);
            z-index: 200; /* Á°Æ‰øùÊµÆÂú®ÊúÄ‰∏äÂ±Ç */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: popIn 0.6s ease-out;
        }

        .random-fab:active {
            transform: scale(0.9) translateY(2px);
            box-shadow: 0 2px 5px rgba(255, 160, 0, 0.4);
        }

        .random-fab .icon { font-size: 32px; line-height: 1; margin-bottom: 2px; text-shadow: 0 2px 0 rgba(0,0,0,0.1); }
        .random-fab .text { font-size: 12px; font-weight: 900; color: #E65100; }

        @keyframes popIn { 0% { transform: scale(0); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        /* Âπ≥ÊùøÂ§ßÂ±èË∞ÉÊï¥ */
        @media (min-width: 768px) {
            .random-fab {
                width: 90px;
                height: 90px;
                bottom: 30px;
                right: 30px;
            }
            .random-fab .icon { font-size: 40px; }
            .random-fab .text { font-size: 16px; }
        }

        .card-icon { font-size: 50px; margin-bottom: 10px; }
        .card-text { font-size: 22px; color: #546E7A; font-weight: 900; }

        .level-grid { display: grid; grid-template-columns: 1fr; gap: 15px; width: 95%; flex: 1; overflow-y: auto; padding: 10px; padding-bottom: 50px; -webkit-overflow-scrolling: touch; }
        @media (min-width: 600px) { .level-grid { grid-template-columns: repeat(2, 1fr); } }

        .level-btn { background: #fff; border: 3px solid #AED581; border-radius: 20px; padding: 10px; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 0 #7CB342; min-height: 100px; }
        .level-num { background: #DCEDC8; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #33691E; font-weight: 900; flex-shrink: 0; }
        .level-thumb { width: 100px; height: 100px; min-width: 100px; min-height: 100px; border-radius: 12px; object-fit: cover; border: 2px solid #AED581; background: #fff; flex-shrink: 0; }
        .level-name { font-size: 20px; color: #555; font-weight: bold; }

        @media (min-width: 768px) {
            .level-thumb { width: 180px; height: 180px; min-width: 180px; min-height: 180px; }
            .level-name { font-size: 32px; }
            .level-num { width: 60px; height: 60px; font-size: 30px; }
        }

        .game-layout { display: flex; width: 100%; height: 100%; padding: 10px; flex-direction: column; gap: 10px; overflow: hidden; }
        @media (min-width: 768px) { .game-layout { flex-direction: row; } }

        .left-panel { flex: 1.2; display: flex; flex-direction: row; background: #E1F5FE; border-radius: 15px; border: 3px solid #fff; box-shadow: 0 4px 0 #81D4FA; padding: 0; align-items: center; justify-content: center; max-height: 30vh; overflow: hidden; transition: all 0.3s; }
        @media (min-width: 768px) { .left-panel { flex: 0.45; flex-direction: column; max-height: none; padding: 10px; } }

        .q-text { font-size: 20px; color: #01579B; margin: 0 5px; font-weight: 900; flex-shrink: 0; writing-mode: vertical-rl; text-orientation: upright; z-index: 2; }
        @media (min-width: 768px) { .q-text { writing-mode: horizontal-tb; font-size: 32px; margin-bottom: 10px; } }

        .q-img { width: auto; height: 100%; max-width: 85%; object-fit: contain; background: #fff; pointer-events: none; -webkit-user-drag: none; user-select: none; touch-action: none; }
        @media (min-width: 768px) { .q-img { width: 100%; height: 100%; max-width: none; border-radius: 10px; max-height: 50vh; } }

        .right-panel { flex: 2; display: flex; flex-direction: column; gap: 10px; min-height: 0; }
        @media (min-width: 768px) { .right-panel { flex: 1; } }

        .answer-area { flex: 1; background: #fff; border-radius: 15px; border: 3px dashed #FFAB91; display: flex; align-items: center; justify-content: space-around; padding: 5px; flex-shrink: 1; }

        .drop-zone { width: auto; height: auto; min-width: 85px; min-height: 85px; max-width: 15vh; max-height: 15vh; aspect-ratio: 1/1; background: #F5F5F5; border: 3px dashed var(--zone-border); border-radius: 12px; display: flex; justify-content: center; align-items: center; position: relative; flex-shrink: 0; overflow: hidden; }
        @media (min-width: 768px) { .drop-zone { min-width: 28vh; min-height: 28vh; max-width: none; max-height: none; border-width: 5px; } .game-layout.mode-full .drop-zone { min-width: 22vh; min-height: 22vh; } }

        .drop-zone::before { content: attr(data-label); color: #E0E0E0; font-size: 20px; font-weight: 900; position: absolute; }
        @media (min-width: 768px) { .drop-zone::before { font-size: 30px; } }
        .drop-zone.highlight { background: #FFF9C4; border-color: var(--zone-active); transform: scale(1.05); }
        .drop-zone.correct { background: #fff; border: 0; }
        .drop-zone .card { position: absolute !important; width: 100% !important; height: 100% !important; border: 0 !important; }

        .store-area { height: 180px; background: #FFF9C4; border-radius: 15px; border: 4px solid #FBC02D; display: flex; flex-direction: column; position: relative; padding: 5px; flex-shrink: 0; }
        @media (min-width: 768px) { .store-area { height: 45vh; min-height: 350px; padding: 15px; } }

        .store-label { position: absolute; top: -12px; left: 10px; background: #FBC02D; color: #fff; padding: 2px 10px; border-radius: 10px; font-size: 14px; font-weight: 900; z-index: 5; }
        .store-scroll { display: flex; align-items: center; gap: 15px; width: 100%; height: 100%; overflow-x: auto; overflow-y: hidden; flex-wrap: nowrap; padding: 10px 5px; -webkit-overflow-scrolling: touch; scroll-behavior: smooth; }

        .card { height: 90%; aspect-ratio: 1/1; flex-shrink: 0; background: #fff; border-radius: 12px; border: 2px solid #fff; padding: 0; box-shadow: 0 4px 8px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; overflow: hidden; touch-action: none; }
        @media (min-width: 768px) { .card { height: 95%; border-radius: 20px; border: 4px solid #fff; } }
        .card img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; background: #f0f0f0; }

        .answer-group { display: flex; flex-direction: column; align-items: center; gap: 5px; flex: 1; height: 100%; justify-content: center; }
        .label-text { font-size: 20px; color: #FF7043; font-weight: 900; margin-bottom: 2px; }
        @media (min-width: 768px) { .label-text { font-size: 28px; } }

        .game-layout.mode-full .left-panel { display: none !important; }
        .game-layout.mode-full .right-panel { flex: 1; }
        .game-layout.mode-full .answer-area { flex-direction: row; }
        @media (max-width: 767px) { .game-layout.mode-full .answer-area { flex-wrap: wrap; align-content: center; } .game-layout.mode-full .answer-group { flex: 0 0 45%; height: 45%; } .game-layout.mode-full .answer-group:nth-child(3) { flex: 0 0 90%; } }

        @media (max-width: 767px) {
            .game-layout.mode-full .store-area { height: auto; flex: 0 0 22vh; padding: 8px 2px; }
            .game-layout.mode-full .store-scroll { display: flex; flex-wrap: wrap; justify-content: space-evenly; align-items: center; overflow-x: hidden; padding: 0; gap: 0; }
            .game-layout.mode-full .store-scroll .card { width: 30%; height: auto; aspect-ratio: 1/1; flex: none; margin: 0; }
        }

        .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px); z-index: 500; display: none; justify-content: center; align-items: center; }
        .modal-box { background: #fff; padding: 20px; border-radius: 20px; text-align: center; width: 80%; max-width: 400px; border: 6px solid #8BC34A; }
        .modal-action-bar { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .modal-btn { background: #8BC34A; color: white; padding: 8px 20px; border-radius: 20px; font-size: 18px; border: 2px solid #fff; box-shadow: 0 3px 0 #558B2F; min-width: 100px; }
    </style>
</head>

<body>
    <div class="sky-layer"><div class="cloud c1"></div><div class="cloud c2"></div><div class="cloud c3"></div><div class="grass"></div></div>
    
    <div class="app-container">
        <div id="screen-main-menu" class="screen" style="display:flex">
            <div class="menu-title">üéà ÈÄ£Êé•Ë©ûÁ∑¥Áøí üéà</div>
            <div class="menu-grid" id="chapter-list"></div>
            <!-- ËøôÈáåÊòØÈÄöËøáJSÂä®ÊÄÅÊèíÂÖ•ÈöèÊú∫ÊåâÈíÆÁöÑÂÆπÂô® -->
        </div>
        <div id="screen-sub-menu" class="screen">
            <div class="btn back-btn" onclick="playClick();showScreen('screen-main-menu')">‚Ü© ËøîÂõû</div>
            <div class="menu-title" id="sub-menu-title" style="font-size:32px;margin-bottom:15px;color:#FF7043">...</div>
            <div class="level-grid" id="level-list"></div>
        </div>
        <div id="screen-game" class="screen" style="padding-top: 0;">
            <div class="btn back-btn" onclick="playClick();quitGame()" style="z-index: 200;">‚Ü© ÈÄÄÂá∫</div>
            <div id="game-layout" class="game-layout">
                <div class="left-panel" id="panel-question">
                    <div class="q-text"><span id="q-text">È°åÁõÆ</span><div class="btn sound-btn" onclick="playClick();speak(document.getElementById('q-text').innerText)">üîä</div></div>
                    <img id="q-img" class="q-img" src="" draggable="false" ondragstart="return false;" oncontextmenu="return false;">
                </div>
                <div class="right-panel">
                    <div class="answer-area" id="answer-container"></div>
                    <div class="store-area">
                        <div class="store-label">üñºÔ∏è Ë≤ºÁ¥ôÂ∫´ (‚û°)</div>
                        <div class="store-scroll" id="sourceContainer"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal" id="successModal">
            <div class="modal-box">
                <h2 style="color:#558B2F;margin:10px;">üéâ Â§™Ê£í‰∫ÜÔºÅ</h2>
                <div style="background:#F1F8E9;padding:15px;border-radius:15px;display:flex;align-items:center;justify-content:center;gap:5px;border:2px dashed #AED581;">
                    <span id="success-sentence" style="font-size:20px;color:#33691E;font-weight:bold;">...</span>
                    <div class="btn sound-btn" onclick="playClick();speak(document.getElementById('success-sentence').innerText)">üîä</div>
                </div>
                <div class="modal-action-bar">
                    <button class="btn modal-btn blue" style="background:#29B6F6;box-shadow:0 3px 0 #0277BD" onclick="playClick();quitGame()">üìú ÂàóË°®</button>
                    <button class="btn modal-btn" onclick="playClick();playNextLevel()">‰∏ã‰∏ÄÈóú ‚û°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const chapters = [
            {
                id: "ch1",
                folder: "ch1",
                title: "Âõ†ÁÇ∫...ÊâÄ‰ª•...",
                icon: "ü§î",
                class: "theme-1",
                mode: "mode-split",
                items: [
                    { label: "Âõ†ÁÇ∫", key: "reason" },
                    { label: "ÊâÄ‰ª•", key: "result" }
                ],
                levels: [
                    {
                        title: "ËÇöÂ≠êÁóõ",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "ËÇöÂ≠êÁóõ_È¢òÁõÆ.png" },
                        cards: [{ key: "reason", img: "ËÇöÂ≠êÁóõ_Âõ†‰∏∫.png" }, { key: "result", img: "ËÇöÂ≠êÁóõ_ÊâÄ‰ª•.png" }],
                        sentence: "Âõ†ÁÇ∫ÂêÉ‰∫ÜÂ§™Â§öÂÜ∞Ê∑áÊ∑ãÔºåÊâÄ‰ª•ËÇöÂ≠êÁóõ„ÄÇ"
                    },
                    {
                        title: "ÊÑüÂÜí‰∫Ü",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "ÊÑüÂÜí_È¢òÁõÆ.png" },
                        cards: [{ key: "reason", img: "ÊÑüÂÜí_Âõ†‰∏∫.png" }, { key: "result", img: "ÊÑüÂÜí_ÊâÄ‰ª•.png" }],
                        sentence: "Âõ†ÁÇ∫Ê∑ãÈõ®ÂÖ®Ë∫´ÊøïÈÄèÔºåÊâÄ‰ª•ÊÑüÂÜí‰∫Ü„ÄÇ"
                    },
                    {
                        title: "ËõÄÁâô‰∫Ü",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "ËõÄÁâô_È¢òÁõÆ.png" },
                        cards: [{ key: "reason", img: "ËõÄÁâô_Âõ†‰∏∫.png" }, { key: "result", img: "ËõÄÁâô_ÊâÄ‰ª•.png" }],
                        sentence: "Âõ†ÁÇ∫Á≥ñÊûúÂêÉÂ§™Â§öÔºåÊâÄ‰ª•ËõÄÁâô‰∫Ü„ÄÇ"
                    },
                    {
                        title: "È´íÂ®ÉÂ®É",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "Ê¥óÂ®ÉÂ®É_È¢òÁõÆ.png" },
                        cards: [{ key: "reason", img: "Ê¥óÂ®ÉÂ®É_Âõ†‰∏∫.png" }, { key: "result", img: "Ê¥óÂ®ÉÂ®É_ÊâÄ‰ª•.png" }],
                        sentence: "Âõ†ÁÇ∫Â®ÉÂ®ÉÁé©È´í‰∫ÜÔºåÊâÄ‰ª•Ë¶ÅÂπ´ÂÆÉÊ¥óÊæ°„ÄÇ"
                    }
                ]
            },
            {
                id: "ch2",
                folder: "ch2",
                title: "ÈõñÁÑ∂...‰ΩÜÊòØ...ÊâÄ‰ª•...",
                icon: "üé¢",
                class: "theme-2",
                mode: "mode-full",
                items: [
                    { label: "ÈõñÁÑ∂", key: "step1" },
                    { label: "‰ΩÜÊòØ", key: "step2" },
                    { label: "ÊâÄ‰ª•", key: "step3" }
                ],
                levels: [
                    {
                        title: "Á∑¥Â∞èÊèêÁê¥",
                        cards: [{ key: "step1", img: "ÁªÉÁê¥_ËôΩÁÑ∂.png" }, { key: "step2", img: "ÁªÉÁê¥_‰ΩÜÊòØ.png" }, { key: "step3", img: "ÁªÉÁê¥_ÊâÄ‰ª•.png" }],
                        sentence: "ÈõñÁÑ∂Á∑¥Áê¥ÂæàËæõËã¶Ôºå‰ΩÜÊòØÊàëÂ†ÖÊåÅÁ∑¥ÁøíÔºåÊâÄ‰ª•Âæó‰∫ÜÁ¨¨‰∏ÄÂêç„ÄÇ"
                    },
                    {
                        title: "ÂêÉÈùíËèú",
                        cards: [{ key: "step1", img: "ÂêÉËèú_ËôΩÁÑ∂.png" }, { key: "step2", img: "ÂêÉËèú_‰ΩÜÊòØ.png" }, { key: "step3", img: "ÂêÉËèú_ÊâÄ‰ª•.png" }],
                        sentence: "ÈõñÁÑ∂Êàë‰∏çÊÑõÂêÉËèúÔºå‰ΩÜÊòØÁÇ∫‰∫ÜË∫´È´îÂÅ•Â∫∑ÔºåÊâÄ‰ª•ÊàëÊääËèúÂêÉÂÖâÂÖâ„ÄÇ"
                    },
                    {
                        title: "‰∏ãÈõ®Â§©",
                        cards: [{ key: "step1", img: "‰∏ãÈõ®_ËôΩÁÑ∂.png" }, { key: "step2", img: "‰∏ãÈõ®_‰ΩÜÊòØ.png" }, { key: "step3", img: "‰∏ãÈõ®_ÊâÄ‰ª•.png" }],
                        sentence: "ÈõñÁÑ∂ÊàëÊÉ≥Âá∫ÂéªÁé©Ôºå‰ΩÜÊòØÂ§ñÈù¢‰∏ãÂ§ßÈõ®ÔºåÊâÄ‰ª•ÊàëÂú®ÂÆ∂Ë£°Áé©„ÄÇ"
                    },
                    {
                        title: "ÁîüÁóÖ‰∫Ü",
                        cards: [{ key: "step1", img: "ÂêÉËçØ_ËôΩÁÑ∂.png" }, { key: "step2", img: "ÂêÉËçØ_‰ΩÜÊòØ.png" }, { key: "step3", img: "ÂêÉËçØ_ÊâÄ‰ª•.png" }],
                        sentence: "ÈõñÁÑ∂Ëó•ÂæàËã¶Ôºå‰ΩÜÊòØÊÉ≥Âà∞ÂêÉÂÆåËó•ÁóÖËÉΩÂ•ΩÔºåÊâÄ‰ª•ÊàëÈñãÂøÉÂú∞ÂêÉËó•„ÄÇ"
                    }
                ]
            },
            {
                id: "ch3",
                folder: "ch3",
                title: "Â¶ÇÊûú...Â∞±...",
                icon: "üí°",
                class: "theme-3",
                mode: "mode-split",
                items: [
                    { label: "Â¶ÇÊûú", key: "cond" },
                    { label: "Â∞±", key: "act" }
                ],
                levels: [
                    {
                        title: "‰∏ãÈõ®Â§©",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "‰∏ãÈõ®_È¢òÁõÆ.png" },
                        cards: [{ key: "cond", img: "‰∏ãÈõ®_Â¶ÇÊûú.png" }, { key: "act", img: "‰∏ãÈõ®_Â∞±.png" }],
                        sentence: "Â¶ÇÊûú‰∏ãÈõ®‰∫ÜÔºåÊàëÂ∞±Â∏∂Èõ®ÂÇò„ÄÇ"
                    },
                    {
                        title: "ÁîüÁóÖ‰∫Ü",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "ÁîüÁóÖ_È¢òÁõÆ.png" },
                        cards: [{ key: "cond", img: "ÁîüÁóÖ_Â¶ÇÊûú.png" }, { key: "act", img: "ÁîüÁóÖ_Â∞±.png" }],
                        sentence: "Â¶ÇÊûúÁîüÁóÖ‰∫ÜÔºåÂ∞±Ë¶ÅÂêÉËó•„ÄÇ"
                    },
                    {
                        title: "ËÇöÂ≠êÈ§ì",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "È•ø_È¢òÁõÆ.png" },
                        cards: [{ key: "cond", img: "È•ø_Â¶ÇÊûú.png" }, { key: "act", img: "È•ø_Â∞±.png" }],
                        sentence: "Â¶ÇÊûúËÇöÂ≠êÈ§ìÔºåÊàëÂ∞±ÂêÉÈ∫µÂåÖ„ÄÇ"
                    },
                    {
                        title: "ÂæàÁ¥Ø",
                        question: { text: "ÁÇ∫‰ªÄÈ∫ºÔºü", img: "Á¥Ø_È¢òÁõÆ.png" },
                        cards: [{ key: "cond", img: "Á¥Ø_Â¶ÇÊûú.png" }, { key: "act", img: "Á¥Ø_Â∞±.png" }],
                        sentence: "Â¶ÇÊûúÊàëÂæàÁ¥ØÔºåÊàëÂ∞±ÂéªÁù°Ë¶∫„ÄÇ"
                    }
                ]
            },
                 {
                id: "ch4",
                folder: "ch4",
                title: "‰πãÊâÄ‰ª•...ÊòØÂõ†ÁÇ∫...",
                icon: "üïµÔ∏è", 
                class: "theme-4",
                mode: "mode-split",
                items: [
                    { label: "ÊòØÂõ†ÁÇ∫", key: "cause" } 
                ],
                levels: [
                    {
                        title: "ÈÅ≤Âà∞",
                        question: { text: "‰πãÊâÄ‰ª•ÈÅ≤Âà∞...", img: "ËøüÂà∞_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cause", img: "ËøüÂà∞_ÊòØÂõ†‰∏∫.png" }, 
                            { key: "wrong1", img: "ËøüÂà∞_ÈîôËØØ.png" }  
                        ],
                        sentence: "‰πãÊâÄ‰ª•ÈÅ≤Âà∞ÔºåÊòØÂõ†ÁÇ∫È¨ßÈêòÂ£û‰∫Ü„ÄÇ"
                    },
                    {
                        title: "ÊãºÂúñ",
                        question: { text: "‰πãÊâÄ‰ª•Êãº‰∏çÂÆå...", img: "ÊãºÂõæ_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cause", img: "ÊãºÂõæ_ÊòØÂõ†‰∏∫.png" }, 
                            { key: "wrong1", img: "ÊãºÂõæ_ÈîôËØØ.png" } 
                        ],
                        sentence: "‰πãÊâÄ‰ª•Êãº‰∏çÂÆåÔºåÊòØÂõ†ÁÇ∫‰∏ü‰∫Ü‰∏ÄÂ°äÊãºÂúñ„ÄÇ"
                    },
                    {
                        title: "ÈûãÂ≠êÊøï",
                        question: { text: "‰πãÊâÄ‰ª•Êøï...", img: "ÈûãÂ≠êÊπø_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cause", img: "ÈûãÂ≠êÊπø_ÊòØÂõ†‰∏∫.png" }, 
                            { key: "wrong1", img: "ÈûãÂ≠êÊπø_ÈîôËØØ.png" }  
                        ],
                        sentence: "‰πãÊâÄ‰ª•ÈûãÂ≠êÊøï‰∫ÜÔºåÊòØÂõ†ÁÇ∫Ë∏©Âà∞Ê∞¥Âùë„ÄÇ"
                    }
                ]
            },
            {
                id: "ch5",
                folder: "ch5",
                title: "ÁÑ°Ë´ñ...ÈÉΩ...",
                icon: "üåã", 
                class: "theme-5",
                mode: "mode-full",
                items: [
                    { label: "ÁÑ°Ë´ñ", key: "cond" }, 
                    { label: "ÈÇÑÊòØ", key: "cond" }, 
                    { label: "ÈÉΩ", key: "result" }
                ],
                levels: [
                    {
                        title: "Âéª‰∏äÂ≠∏",
                        cards: [
                            { key: "cond", img: "‰∏äÂ≠¶_Êó†ËÆ∫Èõ®.png" },   
                            { key: "cond", img: "‰∏äÂ≠¶_Êó†ËÆ∫Èõ™.png" },   
                            { key: "result", img: "‰∏äÂ≠¶_ÈÉΩ.png" } 
                        ],
                        sentence: "ÁÑ°Ë´ñ‰∏ãÈõ®ÈÇÑÊòØ‰∏ãÈõ™ÔºåÊàëÈÉΩË¶ÅÂéª‰∏äÂ≠∏„ÄÇ"
                    },
                    {
                        title: "ÂêÉËî¨Ëèú",
                        cards: [
                            { key: "cond", img: "Ëî¨Ëèú_Êó†ËÆ∫Á∫¢.png" },   
                            { key: "cond", img: "Ëî¨Ëèú_Êó†ËÆ∫Áªø.png" },  
                            { key: "result", img: "Ëî¨Ëèú_ÈÉΩ.png" }  
                        ],
                        sentence: "ÁÑ°Ë´ñÁ¥ÖËâ≤ÁöÑÈÇÑÊòØÁ∂†Ëâ≤ÁöÑÔºåËî¨ËèúÊàëÈÉΩË¶ÅÂêÉ„ÄÇ"
                    },
                    {
                        title: "Â∞èÁãó",
                        cards: [
                            { key: "cond", img: "Áãó_Êó†ËÆ∫Ë∑ë.png" },    
                            { key: "cond", img: "Áãó_Êó†ËÆ∫Èùô.png" },    
                            { key: "result", img: "Áãó_ÈÉΩ.png" }  
                        ],
                        sentence: "ÁÑ°Ë´ñÂ∞èÁãóÊòØÂÆâÈùúÁöÑÈÇÑÊòØÊ¥ªÊΩëÁöÑÔºåÊàëÈÉΩÂñúÊ≠°ÂíåÂÆÉÁé©„ÄÇ"
                    },
                    {
                        title: "Áï´Áï´",
                        cards: [
                            { key: "cond", img: "Áîª_Êó†ËÆ∫Áîª.png" }, 
                            { key: "cond", img: "Áîª_Êó†ËÆ∫ÂÜô.png" },   
                            { key: "result", img: "Áîª_ÈÉΩ.png" }  
                        ],
                        sentence: "ÁÑ°Ë´ñÁï´Áï´ÈÇÑÊòØÂØ´Â≠óÔºåÊàëÈÉΩË™çÁúüÂÆåÊàê„ÄÇ"
                    }
                ]
            },
            {
                id: "ch6",
                folder: "ch6",
                title: "Âè™Ë¶Å...Â∞±...",
                icon: "üîë", 
                class: "theme-6",
                mode: "mode-split",
                items: [
                    { label: "Âè™Ë¶Å", key: "cond" },
                    { label: "Â∞±", key: "res" }
                ],
                levels: [
                    {
                        title: "‰∫ÆÁáà",
                        question: { text: "ÊÄéÈ∫ºÂÅöÔºü", img: "ÂºÄÁÅØ_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cond", img: "ÂºÄÁÅØ_Âè™Ë¶Å.png" }, 
                            { key: "res", img: "ÂºÄÁÅØ_Â∞±.png" }  
                        ],
                        sentence: "Âè™Ë¶ÅÊåâ‰∏ãÈñãÈóúÔºåÁáàÂ∞±ÊúÉ‰∫Æ„ÄÇ"
                    },
                    {
                        title: "ÊæÜËä±",
                        question: { text: "ÊÄéÈ∫ºÂÅöÔºü", img: "ÊµáËä±_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cond", img: "ÊµáËä±_Âè™Ë¶Å.png" },  
                            { key: "res", img: "ÊµáËä±_Â∞±.png" }   
                        ],
                        sentence: "Âè™Ë¶ÅÊæÜÊ∞¥ÔºåËä±Â∞±ÊúÉÈï∑Â§ß„ÄÇ"
                    },
                    {
                        title: "ÈñãÈñÄ",
                        question: { text: "ÊÄéÈ∫ºÂÅöÔºü", img: "ÂºÄÈó®_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cond", img: "ÂºÄÈó®_Âè™Ë¶Å.png" }, 
                            { key: "res", img: "ÂºÄÈó®_Â∞±.png" }    
                        ],
                        sentence: "Âè™Ë¶ÅËºïËºïÊï≤ÈñÄÔºåÊúãÂèãÂ∞±ÊúÉ‰æÜÈñãÈñÄ„ÄÇ"
                    },
                    {
                        title: "ÈñãÈéñ",
                        question: { text: "ÊÄéÈ∫ºÂÅöÔºü", img: "ÂºÄÈîÅ_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "cond", img: "ÂºÄÈîÅ_Âè™Ë¶Å.png" }, 
                            { key: "res", img: "ÂºÄÈîÅ_Â∞±.png" }    
                        ],
                        sentence: "Âè™Ë¶ÅÊúâÈë∞ÂåôÔºåÂ∞±ËÉΩÊâìÈñãÈéñ„ÄÇ"
                    }
                ]
            },
            {
                id: "ch7",
                folder: "ch7",
                title: "‰∏çÊòØ...ËÄåÊòØ...",
                icon: "üôÖ", 
                class: "theme-7",
                mode: "mode-split",
                items: [
                    { label: "‰∏çÊòØ", key: "not" },
                    { label: "ËÄåÊòØ", key: "is" }
                ],
                levels: [
                    {
                        title: "Áπ©Â≠ê",
                        question: { text: "ÈÄôÊòØÔºü", img: "Áª≥Â≠ê_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "not", img: "Áª≥Â≠ê_‰∏çÊòØ.png" }, 
                            { key: "is", img: "Áª≥Â≠ê_ËÄåÊòØ.png" }    
                        ],
                        sentence: "ÈÄô‰∏çÊòØËõáÔºåËÄåÊòØ‰∏ÄÊ¢ùÁπ©Â≠ê„ÄÇ"
                    },
                    {
                        title: "Èõ≤ÂΩ©",
                        question: { text: "ÈÄôÊòØÔºü", img: "‰∫ë_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "not", img: "‰∫ë_‰∏çÊòØ.png" },  
                            { key: "is", img: "‰∫ë_ËÄåÊòØ.png" }     
                        ],
                        sentence: "ÈÄô‰∏çÊòØÊ£âËä±Á≥ñÔºåËÄåÊòØÈõ≤ÂΩ©„ÄÇ"
                    },
                    {
                        title: "Áé©ÂÖ∑",
                        question: { text: "ÈÄôÊòØÔºü", img: "Áé©ÂÖ∑_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "not", img: "Áé©ÂÖ∑_‰∏çÊòØ.png" }, 
                            { key: "is", img: "Áé©ÂÖ∑_ËÄåÊòØ.png" }     
                        ],
                        sentence: "ÈÄô‰∏çÊòØÁúüËªäÔºåËÄåÊòØÁé©ÂÖ∑Ëªä„ÄÇ"
                    },
                    {
                        title: "Áï´Á≠Ü",
                        question: { text: "ÈÄôÊòØÔºü", img: "Á¨î_È¢òÁõÆ.png" }, 
                        cards: [
                            { key: "not", img: "Á¨î_‰∏çÊòØ.png" },  
                            { key: "is", img: "Á¨î_ËÄåÊòØ.png" }   
                        ],
                        sentence: "ÈÄô‰∏çÊòØÁ≠∑Â≠êÔºåËÄåÊòØÁï´Á≠Ü„ÄÇ"
                    }
                ]
            }
        ]; 

        let curCh = 0, curLv = 0, cnt = 0, tgt = 0;
        const ctx = new (window.AudioContext || window.webkitAudioContext)();

        function playClick() {
            if (ctx.state === 'suspended') ctx.resume();
            const o = ctx.createOscillator(), g = ctx.createGain();
            o.type = 'sine';
            o.frequency.setValueAtTime(600, ctx.currentTime);
            g.gain.setValueAtTime(0.2, ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.15);
            o.connect(g);
            g.connect(ctx.destination);
            o.start();
            o.stop(ctx.currentTime + 0.15);
        }

        function playCorrect() {
            if (ctx.state === 'suspended') ctx.resume();
            const n = ctx.currentTime;
            [523.25, 659.25, 783.99, 1046.50].forEach((f, i) => {
                const o = ctx.createOscillator(), g = ctx.createGain();
                o.type = 'triangle';
                o.frequency.value = f;
                g.gain.setValueAtTime(0.1, n + i * 0.08);
                g.gain.exponentialRampToValueAtTime(0.001, n + i * 0.08 + 0.5);
                o.connect(g);
                g.connect(ctx.destination);
                o.start(n + i * 0.08);
                o.stop(n + i * 0.08 + 0.5);
            });
        }

        function playWrong() {
            if (ctx.state === 'suspended') ctx.resume();
            const o = ctx.createOscillator(), g = ctx.createGain();
            o.type = 'sawtooth';
            o.frequency.value = 150;
            o.frequency.linearRampToValueAtTime(100, ctx.currentTime + 0.3);
            g.gain.setValueAtTime(0.1, ctx.currentTime);
            g.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.3);
            o.connect(g);
            g.connect(ctx.destination);
            o.start();
            o.stop(ctx.currentTime + 0.3);
        }

        function speak(t) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.lang = 'zh-HK';
            u.rate = 0.9;
            u.pitch = 1.2;
            window.speechSynthesis.speak(u);
        }

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById('successModal').style.display = 'none';
            document.getElementById(id).style.display = 'flex';
        }

        function initMainMenu() {
            const c = document.getElementById('chapter-list');
            c.innerHTML = '';
            chapters.forEach((ch, i) => {
                const b = document.createElement('div');
                b.className = `theme-card btn ${ch.class}`;
                b.innerHTML = `<div class="card-icon">${ch.icon}</div><div class="card-text">${ch.title}</div>`;
                b.onclick = () => { playClick(); openSubMenu(i) };
                c.appendChild(b);
            });
            // Á°Æ‰øùÈöèÊú∫ÊåâÈíÆÂú®ËèúÂçïÂàùÂßãÂåñÂêéÊ∑ªÂä†
            addRandomButton();
        }

        function openSubMenu(i) {
            curCh = i;
            document.getElementById('sub-menu-title').innerText = chapters[i].title;
            const c = document.getElementById('level-list');
            c.innerHTML = '';
            chapters[i].levels.forEach((l, li) => {
                const b = document.createElement('div');
                b.className = 'level-btn btn';
                const imgSrc = (l.question && l.question.img) ? l.question.img : (l.cards[0] ? l.cards[0].img : '');
                const fullPath = `images/${chapters[i].folder}/${imgSrc}`;

                b.innerHTML = `
                    <div class="level-num">${li + 1}</div>
                    <img class="level-thumb" src="${fullPath}">
                    <div class="level-name">${l.title}</div>
                `;
                b.onclick = () => { playClick(); startGame(li) };
                c.appendChild(b);
            });
            showScreen('screen-sub-menu');
        }

        function startGame(li) {
            curLv = li;
            loadLevel();
            showScreen('screen-game');
        }

        function loadLevel() {
            const ch = chapters[curCh];
            if (curLv >= ch.levels.length && !isRandomMode) {
                alert("ÂÆåÊàêÔºÅ");
                showScreen('screen-sub-menu');
                return;
            }
            const d = ch.levels[curLv], layout = document.getElementById('game-layout');
            layout.className = 'game-layout';
            if (ch.mode) layout.classList.add(ch.mode);
            const folderPath = `images/${ch.folder}/`;

            const leftPanel = document.getElementById('panel-question');
            if (ch.mode === 'mode-full') {
                leftPanel.style.display = 'none';
            } else {
                leftPanel.style.display = 'flex';
                document.getElementById('q-text').innerText = d.question.text;
                document.getElementById('q-img').src = folderPath + d.question.img;
            }
            
            const ac = document.getElementById('answer-container');
            ac.innerHTML = '';
            ch.items.forEach(it => {
                const g = document.createElement('div');
                g.className = 'answer-group';
                g.innerHTML = `<div class="label-text">${it.label}<div class="btn sound-btn" onclick="playClick();speak('${it.label}')">üîä</div></div><div class="drop-zone" data-key="${it.key}" data-label="${it.label}"></div>`;
                ac.appendChild(g);
            });
            
            const sc = document.getElementById('sourceContainer');
            sc.innerHTML = '';
            [...d.cards].sort(() => Math.random() - 0.5).forEach(cd => {
                const c = document.createElement('div');
                c.className = 'card btn';
                c.draggable = true;
                c.id = 'c-' + Math.random().toString(36).substr(2, 9);
                c.dataset.key = cd.key;
                c.innerHTML = `<img src="${folderPath + cd.img}">`;
                c.onmousedown = () => playClick();
                c.addEventListener('touchstart', () => playClick());

                c.addEventListener('dragstart', e => {
                    e.dataTransfer.setData('key', e.target.dataset.key);
                    e.dataTransfer.setData('id', e.target.id);
                    setTimeout(() => e.target.classList.add('dragging'), 0);
                });
                c.addEventListener('dragend', e => {
                    e.target.classList.remove('dragging');
                });
                sc.appendChild(c);
            });
            
            cnt = 0;
            tgt = ch.items.length;
            document.querySelectorAll('.drop-zone').forEach(z => {
                z.addEventListener('dragover', e => e.preventDefault());
                z.addEventListener('dragenter', function (e) {
                    e.preventDefault();
                    this.classList.add('highlight');
                });
                z.addEventListener('dragleave', function () {
                    this.classList.remove('highlight');
                });
                z.addEventListener('drop', handleDrop);
            });
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('highlight');
            if (this.children.length > 0) return;
            
            const k = e.dataTransfer.getData('key');
            const id = e.dataTransfer.getData('id');
            const c = document.getElementById(id);
            
            if (k === this.dataset.key) {
                this.appendChild(c);
                this.classList.add('correct');
                c.draggable = false;
                playCorrect();
                cnt++;
                if (cnt === tgt) {
                    document.getElementById('success-sentence').innerText = chapters[curCh].levels[curLv].sentence;
                    setTimeout(() => {
                        document.getElementById('successModal').style.display = 'flex';
                        playCorrect();
                    }, 500);
                }
            } else {
                playWrong();
                this.style.borderColor = 'red';
                setTimeout(() => {
                    this.style.borderColor = ''; 
                }, 500);
            }
        }

        // --- Êñ∞Â¢ûÂäüËÉΩÔºöÈöèÊú∫ÈóØÂÖ≥Ê®°Âºè ---

        let isRandomMode = false;
        let randomQueue = []; 

        function addRandomButton() {
            const parent = document.getElementById('screen-main-menu');
            if(document.getElementById('random-btn-fab')) return; 

            const b = document.createElement('div');
            b.id = 'random-btn-fab';
            b.className = 'btn random-fab';
            b.innerHTML = `<div class="icon">üé≤</div><div class="text">Èö®Ê©ü</div>`;
            b.onclick = () => { playClick(); startRandomMode(); };
            
            parent.appendChild(b);
        }

        function startRandomMode() {
            isRandomMode = true;
            randomQueue = [];
            
            chapters.forEach((ch, cIdx) => {
                ch.levels.forEach((lv, lIdx) => {
                    randomQueue.push({c: cIdx, l: lIdx});
                });
            });

            for (let i = randomQueue.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [randomQueue[i], randomQueue[j]] = [randomQueue[j], randomQueue[i]];
            }

            console.log("ÈöèÊú∫ÈòüÂàóÂ∑≤ÁîüÊàêÔºåÂÖ± " + randomQueue.length + " ÂÖ≥");
            playNextRandomLevel();
        }

        function playNextRandomLevel() {
            if (randomQueue.length === 0) {
                alert("Â§™Âé≤ÂÆ≥‰∫ÜÔºÅ‰Ω†Â∑≤Á∂ìÈÄöÈóú‰∫ÜÊâÄÊúâÈ°åÁõÆÔºÅüéâ");
                quitGame();
                return;
            }

            const nextLevel = randomQueue.pop(); 
            curCh = nextLevel.c;
            curLv = nextLevel.l; 
            
            loadLevel(); 
            showScreen('screen-game');
        }

        function playNextLevel() {
            document.getElementById('successModal').style.display = 'none';
            
            if (isRandomMode) {
                playNextRandomLevel();
            } else {
                if (curLv + 1 < chapters[curCh].levels.length) {
                    curLv++;
                    loadLevel();
                } else {
                    alert("Êú¨Á´†ÁØÄÂ∑≤ÂÆåÊàêÔºÅüëè");
                    showScreen('screen-sub-menu');
                }
            }
        }

        function quitGame() {
            document.getElementById('successModal').style.display = 'none';
            if (isRandomMode) {
                isRandomMode = false;
                showScreen('screen-main-menu'); 
            } else {
                showScreen('screen-sub-menu'); 
            }
        }

        initMainMenu();
    </script>
</body>

</html>


